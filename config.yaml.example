# Amp Sentinel — 配置文件示例
# 复制此文件为 config.yaml 并按实际情况修改

# Amp CLI 配置
amp:
  api_key: "${AMP_API_KEY}"           # 从 https://ampcode.com/settings 获取
  binary: "amp"
  default_mode: "smart"

# 调度器配置
scheduler:
  max_concurrency: 3
  queue_size: 100
  default_timeout: "15m"
  retry_count: 2
  retry_delay: "10s"

# 诊断配置
diagnosis:
  structured_output: true
  json_fixer_enabled: true
  prompt_version: "v1"
  # P1: 历史指纹复用
  fingerprint_reuse_enabled: true
  fingerprint_reuse_window: "24h"
  fingerprint_reuse_min_score: 80

# 故障接入配置
intake:
  listen: ":8080"
  dedup_window: "10m"
  rate_limit_per_hour: 10
  min_severity: "warning"
  auth_token: "${INTAKE_AUTH_TOKEN}"   # openssl rand -hex 32 生成

# 项目注册表
projects:
  - key: "your-project"
    name: "你的项目名称"
    repo_url: "git@github.com:your-org/your-repo.git"
    branch: "main"
    language: "go"
    skills: []
    owners: ["张三"]
    feishu_webhook: "https://open.feishu.cn/open-apis/bot/v2/hook/xxx"

# 源码管理配置
source:
  base_dir: "./data/repos"
  git_ssh_key: "${GIT_SSH_KEY_PATH}"  # SSH 私钥路径

# Skill 配置
skill:
  dir: "./skills"

# 飞书通知配置
feishu:
  default_webhook: "https://open.feishu.cn/open-apis/bot/v2/hook/xxx"
  timeout: "10s"
  retry_count: 3
  sign_key: "${FEISHU_SIGN_KEY}"
  dashboard_url: "http://your-server:9090/admin/dashboard/"

# 持久化配置
store:
  type: "sqlite"
  sqlite:
    path: "./data/sentinel.db"
  # mysql:
  #   dsn: "${MYSQL_DSN}"
  #   max_open_conns: 10
  #   max_idle_conns: 5
  #   conn_max_lifetime: "5m"
  # json:
  #   path: "./data/sentinel.json"

# 日志配置
logger:
  level: "info"
  console:
    enabled: true
    color: true
  file:
    enabled: false
    dir: "./logs"
    max_size_mb: 100
    max_age_days: 30
  session:
    enabled: true
    dir: "./logs/sessions"

# 管理后台 API
admin_api:
  enabled: true
  listen: ":9090"
  auth_token: "${ADMIN_API_TOKEN}"
